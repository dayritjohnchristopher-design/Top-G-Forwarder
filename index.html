<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tracking System</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    input, button { padding: 8px; margin: 5px 0; width: 300px; }
    #trackingResult { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Update Tracking</h1>
  <form id="trackingForm">
    <input type="text" id="waybill" placeholder="Waybill Number" required><br>
    <input type="text" id="status" placeholder="Status/Location" required><br>
    <button type="submit">Update Tracking</button>
  </form>

  <h1>Search Tracking</h1>
  <input type="text" id="searchWaybill" placeholder="Enter Waybill Number">
  <div id="trackingResult">Search result will appear here</div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

    // ðŸ”¹ Replace this config with your Firebase project config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Handle form submit
    const form = document.getElementById('trackingForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const waybill = document.getElementById('waybill').value.trim();
      const status = document.getElementById('status').value.trim();
      if (!waybill || !status) return alert("Please fill in all fields");

      try {
        await setDoc(doc(db, "trackings", waybill), {
          status: status,
          updatedAt: serverTimestamp()
        });
        alert("Tracking updated successfully!");
        form.reset();
      } catch (err) {
        console.error(err);
        alert("Error saving tracking. Check console.");
      }
    });

    // Handle search
    const searchInput = document.getElementById('searchWaybill');
    const resultDiv = document.getElementById('trackingResult');

    searchInput.addEventListener('input', async (e) => {
      const waybill = e.target.value.trim();
      if (!waybill) {
        resultDiv.innerText = "Search result will appear here";
        return;
      }

      try {
        const docRef = doc(db, "trackings", waybill);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          const data = docSnap.data();
          const date = data.updatedAt?.toDate()?.toLocaleString() || "Unknown";
          resultDiv.innerText = `Status: ${data.status}\nLast Updated: ${date}`;
        } else {
          resultDiv.innerText = "Waybill not found.";
        }
      } catch (err) {
        console.error(err);
        resultDiv.innerText = "Error fetching tracking info.";
      }
    });
  </script>
</body>
</html>
